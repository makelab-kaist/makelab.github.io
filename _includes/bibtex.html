{% assign bib = include.bibtex | default: page.bibtex %}

<section class="section" id="BibTeX">
    <div class="content">
        <div class="bibtex-header">
            <h3 class="h3">Reference</h3>
            <button class="copy-bibtex-btn" onclick="copyBibTeX()" title="Copy BibTeX to clipboard">
                <i class="fas fa-copy"></i>
                <span class="copy-text">Copy</span>
            </button>
        </div>

        <pre id="bibtex-code"><code>{%- if bib -%}{{- bib | strip | escape -}}{%- else -%}@article{YourPaperKey2024,
  title={Your Paper Title Here},
  author={First Author and Second Author and Third Author},
  journal={Conference/Journal Name},
  year={2024},
  url={https://your-domain.com/your-project-page}
}{%- endif -%}</code></pre>

    </div>
</section>

<script>
    // Copy BibTeX to clipboard (shared include)
    function copyBibTeX() {
        const bibtexElement = document.getElementById('bibtex-code');
        const button = document.querySelector('.copy-bibtex-btn');
        const copyText = button ? button.querySelector('.copy-text') : null;

        if (!bibtexElement || !button) return;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(bibtexElement.textContent).then(function () {
                button.classList.add('copied');
                if (copyText) copyText.textContent = 'Copied';
                setTimeout(function () {
                    button.classList.remove('copied');
                    if (copyText) copyText.textContent = 'Copy';
                }, 2000);
            }).catch(function (err) {
                fallbackCopy(bibtexElement, button, copyText);
            });
        } else {
            fallbackCopy(bibtexElement, button, copyText);
        }
    }

    function fallbackCopy(bibtexElement, button, copyText) {
        try {
            const textArea = document.createElement('textarea');
            textArea.value = bibtexElement.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            button.classList.add('copied');
            if (copyText) copyText.textContent = 'Copied';
            setTimeout(function () {
                button.classList.remove('copied');
                if (copyText) copyText.textContent = 'Copy';
            }, 2000);
        } catch (e) {
            console.error('Copy failed', e);
        }
    }
</script>